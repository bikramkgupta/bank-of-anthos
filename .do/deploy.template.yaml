name: ${APP_NAME}
region: ${APP_REGION}
vpc:
  id: 20ccc9c3-2bad-40dc-9669-8d5ef784b765
services:
  - name: frontend
    github:
      repo: ${GITHUB_REPO}
      branch: ${GITHUB_BRANCH}
      deploy_on_push: false
    source_dir: src/frontend
    dockerfile_path: src/frontend/Dockerfile
    http_port: 8080
    instance_count: 1
    instance_size_slug: basic-xxs
    envs:
      - key: BALANCES_API_ADDR
        value: balancereader:8080
        scope: RUN_TIME
      - key: CONTACTS_API_ADDR
        value: contacts:8080
        scope: RUN_TIME
      - key: TRANSACTIONS_API_ADDR
        value: ledgerwriter:8080
        scope: RUN_TIME
      - key: HISTORY_API_ADDR
        value: transactionhistory:8080
        scope: RUN_TIME
      - key: USERSERVICE_API_ADDR
        value: userservice:8080
        scope: RUN_TIME
      - key: LOCAL_ROUTING_NUM
        value: "883745000"
        scope: RUN_TIME
      - key: USE_DEMO_DATA
        value: "true"
        scope: RUN_TIME
      - key: JWT_PUBLIC_KEY
        value: ${JWT_PUBLIC_KEY}
        type: SECRET
        scope: RUN_TIME
      - key: ENABLE_TRACING
        value: "false"
        scope: RUN_TIME
      - key: ENABLE_METRICS
        value: "false"
        scope: RUN_TIME
  - name: userservice
    github:
      repo: ${GITHUB_REPO}
      branch: ${GITHUB_BRANCH}
      deploy_on_push: false
    source_dir: src/accounts/userservice
    dockerfile_path: src/accounts/userservice/Dockerfile
    internal_ports: [8080]
    instance_count: 1
    instance_size_slug: basic-xxs
    envs:
      - key: POSTGRES_HOST
        value: ${accountsdb.HOST}
        scope: RUN_TIME
      - key: POSTGRES_PORT
        value: ${accountsdb.PORT}
        scope: RUN_TIME
      - key: POSTGRES_USER
        value: ${accountsdb.USER}
        scope: RUN_TIME
      - key: POSTGRES_PASSWORD
        value: ${accountsdb.PASSWORD}
        scope: RUN_TIME
      - key: POSTGRES_DB
        value: ${ACCOUNTS_DB_NAME}
        scope: RUN_TIME
      - key: ACCOUNTS_DB_URI
        value: postgresql://${accountsdb.USER}:${accountsdb.PASSWORD}@${accountsdb.HOST}:${accountsdb.PORT}/${ACCOUNTS_DB_NAME}?sslmode=require
        scope: RUN_TIME
      - key: USE_DEMO_DATA
        value: "true"
        scope: RUN_TIME
      - key: LOCAL_ROUTING_NUM
        value: "883745000"
        scope: RUN_TIME
      - key: JWT_PRIVATE_KEY
        value: ${JWT_PRIVATE_KEY}
        type: SECRET
        scope: RUN_TIME
      - key: JWT_PUBLIC_KEY
        value: ${JWT_PUBLIC_KEY}
        type: SECRET
        scope: RUN_TIME
      - key: ENABLE_TRACING
        value: "false"
        scope: RUN_TIME
      - key: ENABLE_METRICS
        value: "false"
        scope: RUN_TIME
  - name: contacts
    github:
      repo: ${GITHUB_REPO}
      branch: ${GITHUB_BRANCH}
      deploy_on_push: false
    source_dir: src/accounts/contacts
    dockerfile_path: src/accounts/contacts/Dockerfile
    internal_ports: [8080]
    instance_count: 1
    instance_size_slug: basic-xxs
    envs:
      - key: POSTGRES_HOST
        value: ${accountsdb.HOST}
        scope: RUN_TIME
      - key: POSTGRES_PORT
        value: ${accountsdb.PORT}
        scope: RUN_TIME
      - key: POSTGRES_USER
        value: ${accountsdb.USER}
        scope: RUN_TIME
      - key: POSTGRES_PASSWORD
        value: ${accountsdb.PASSWORD}
        scope: RUN_TIME
      - key: POSTGRES_DB
        value: ${ACCOUNTS_DB_NAME}
        scope: RUN_TIME
      - key: ACCOUNTS_DB_URI
        value: postgresql://${accountsdb.USER}:${accountsdb.PASSWORD}@${accountsdb.HOST}:${accountsdb.PORT}/${ACCOUNTS_DB_NAME}?sslmode=require
        scope: RUN_TIME
      - key: USE_DEMO_DATA
        value: "true"
        scope: RUN_TIME
      - key: LOCAL_ROUTING_NUM
        value: "883745000"
        scope: RUN_TIME
      - key: JWT_PUBLIC_KEY
        value: ${JWT_PUBLIC_KEY}
        type: SECRET
        scope: RUN_TIME
      - key: ENABLE_TRACING
        value: "false"
        scope: RUN_TIME
      - key: ENABLE_METRICS
        value: "false"
        scope: RUN_TIME
  - name: ledgerwriter
    github:
      repo: ${GITHUB_REPO}
      branch: ${GITHUB_BRANCH}
      deploy_on_push: false
    source_dir: src/ledger/ledgerwriter
    dockerfile_path: src/ledger/ledgerwriter/Dockerfile
    internal_ports: [8080]
    instance_count: 1
    instance_size_slug: basic-xxs
    envs:
      - key: POSTGRES_HOST
        value: ${ledgerdb.HOST}
        scope: RUN_TIME
      - key: POSTGRES_PORT
        value: ${ledgerdb.PORT}
        scope: RUN_TIME
      - key: POSTGRES_USER
        value: ${ledgerdb.USER}
        scope: RUN_TIME
      - key: POSTGRES_PASSWORD
        value: ${ledgerdb.PASSWORD}
        scope: RUN_TIME
      - key: POSTGRES_DB
        value: ${LEDGER_DB_NAME}
        scope: RUN_TIME
      - key: SPRING_DATASOURCE_URL
        value: jdbc:postgresql://${ledgerdb.HOST}:${ledgerdb.PORT}/${LEDGER_DB_NAME}?sslmode=require
        scope: RUN_TIME
      - key: SPRING_DATASOURCE_USERNAME
        value: ${ledgerdb.USER}
        scope: RUN_TIME
      - key: SPRING_DATASOURCE_PASSWORD
        value: ${ledgerdb.PASSWORD}
        scope: RUN_TIME
      - key: BALANCES_API_ADDR
        value: balancereader:8080
        scope: RUN_TIME
      - key: LOCAL_ROUTING_NUM
        value: "883745000"
        scope: RUN_TIME
      - key: JWT_PUBLIC_KEY
        value: ${JWT_PUBLIC_KEY}
        type: SECRET
        scope: RUN_TIME
      - key: ENABLE_TRACING
        value: "false"
        scope: RUN_TIME
      - key: ENABLE_METRICS
        value: "false"
        scope: RUN_TIME
  - name: balancereader
    github:
      repo: ${GITHUB_REPO}
      branch: ${GITHUB_BRANCH}
      deploy_on_push: false
    source_dir: src/ledger/balancereader
    dockerfile_path: src/ledger/balancereader/Dockerfile
    internal_ports: [8080]
    instance_count: 1
    instance_size_slug: basic-xxs
    envs:
      - key: POSTGRES_HOST
        value: ${ledgerdb.HOST}
        scope: RUN_TIME
      - key: POSTGRES_PORT
        value: ${ledgerdb.PORT}
        scope: RUN_TIME
      - key: POSTGRES_USER
        value: ${ledgerdb.USER}
        scope: RUN_TIME
      - key: POSTGRES_PASSWORD
        value: ${ledgerdb.PASSWORD}
        scope: RUN_TIME
      - key: POSTGRES_DB
        value: ${LEDGER_DB_NAME}
        scope: RUN_TIME
      - key: SPRING_DATASOURCE_URL
        value: jdbc:postgresql://${ledgerdb.HOST}:${ledgerdb.PORT}/${LEDGER_DB_NAME}?sslmode=require
        scope: RUN_TIME
      - key: SPRING_DATASOURCE_USERNAME
        value: ${ledgerdb.USER}
        scope: RUN_TIME
      - key: SPRING_DATASOURCE_PASSWORD
        value: ${ledgerdb.PASSWORD}
        scope: RUN_TIME
      - key: LOCAL_ROUTING_NUM
        value: "883745000"
        scope: RUN_TIME
      - key: JWT_PUBLIC_KEY
        value: ${JWT_PUBLIC_KEY}
        type: SECRET
        scope: RUN_TIME
      - key: ENABLE_TRACING
        value: "false"
        scope: RUN_TIME
      - key: ENABLE_METRICS
        value: "false"
        scope: RUN_TIME
  - name: transactionhistory
    github:
      repo: ${GITHUB_REPO}
      branch: ${GITHUB_BRANCH}
      deploy_on_push: false
    source_dir: src/ledger/transactionhistory
    dockerfile_path: src/ledger/transactionhistory/Dockerfile
    internal_ports: [8080]
    instance_count: 1
    instance_size_slug: basic-xxs
    envs:
      - key: POSTGRES_HOST
        value: ${ledgerdb.HOST}
        scope: RUN_TIME
      - key: POSTGRES_PORT
        value: ${ledgerdb.PORT}
        scope: RUN_TIME
      - key: POSTGRES_USER
        value: ${ledgerdb.USER}
        scope: RUN_TIME
      - key: POSTGRES_PASSWORD
        value: ${ledgerdb.PASSWORD}
        scope: RUN_TIME
      - key: POSTGRES_DB
        value: ${LEDGER_DB_NAME}
        scope: RUN_TIME
      - key: SPRING_DATASOURCE_URL
        value: jdbc:postgresql://${ledgerdb.HOST}:${ledgerdb.PORT}/${LEDGER_DB_NAME}?sslmode=require
        scope: RUN_TIME
      - key: SPRING_DATASOURCE_USERNAME
        value: ${ledgerdb.USER}
        scope: RUN_TIME
      - key: SPRING_DATASOURCE_PASSWORD
        value: ${ledgerdb.PASSWORD}
        scope: RUN_TIME
      - key: LOCAL_ROUTING_NUM
        value: "883745000"
        scope: RUN_TIME
      - key: JWT_PUBLIC_KEY
        value: ${JWT_PUBLIC_KEY}
        type: SECRET
        scope: RUN_TIME
      - key: ENABLE_TRACING
        value: "false"
        scope: RUN_TIME
      - key: ENABLE_METRICS
        value: "false"
        scope: RUN_TIME
workers:
  - name: loadgenerator
    github:
      repo: ${GITHUB_REPO}
      branch: ${GITHUB_BRANCH}
      deploy_on_push: false
    source_dir: src/loadgenerator
    dockerfile_path: src/loadgenerator/Dockerfile
    instance_count: 1
    instance_size_slug: basic-xxs
    envs:
      - key: FRONTEND_ADDR
        value: frontend:8080
        scope: RUN_TIME
      - key: USE_DEMO_DATA
        value: "true"
        scope: RUN_TIME
      - key: ENABLE_TRACING
        value: "false"
        scope: RUN_TIME
      - key: ENABLE_METRICS
        value: "false"
        scope: RUN_TIME
databases:
  - name: accountsdb
    engine: PG
    version: "15"
    size: db-s-dev-database
    num_nodes: 1
    production: true
    cluster_name: boa-staging-postgres
    db_name: ${ACCOUNTS_DB_NAME}
    db_user: accounts_user
  - name: ledgerdb
    engine: PG
    version: "15"
    size: db-s-dev-database
    num_nodes: 1
    production: true
    cluster_name: boa-staging-postgres
    db_name: ${LEDGER_DB_NAME}
    db_user: ledger_user
